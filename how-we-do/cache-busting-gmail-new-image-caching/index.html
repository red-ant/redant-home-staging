<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="google-site-verification" content="uky3VJEeD3NAFHIK0V4KLdxlYF7fGGXJYyyt96LLe78" />
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Cache busting Gmail’s new image caching | Red Ant</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Cache busting Gmail’s new image caching" />
<meta name="author" content="Sam Bauers" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Google’s new image caching mechanism in Gmail is an email marketer’s nightmare come true. Here’s how to keep tracking your email opens in Gmail." />
<meta property="og:description" content="Google’s new image caching mechanism in Gmail is an email marketer’s nightmare come true. Here’s how to keep tracking your email opens in Gmail." />
<link rel="canonical" href="https://redant.com.au/how-we-do/cache-busting-gmail-new-image-caching/" />
<meta property="og:url" content="https://redant.com.au/how-we-do/cache-busting-gmail-new-image-caching/" />
<meta property="og:site_name" content="Red Ant" />
<meta property="og:image" content="https://redant.com.au/assets/uploads/2013/somebody-set-us-up-the-bomb.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2013-12-16T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://redant.com.au/assets/uploads/2013/somebody-set-us-up-the-bomb.jpg" />
<meta property="twitter:title" content="Cache busting Gmail’s new image caching" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Sam Bauers"},"dateModified":"2013-12-16T00:00:00+00:00","datePublished":"2013-12-16T00:00:00+00:00","description":"Google’s new image caching mechanism in Gmail is an email marketer’s nightmare come true. Here’s how to keep tracking your email opens in Gmail.","headline":"Cache busting Gmail’s new image caching","image":"https://redant.com.au/assets/uploads/2013/somebody-set-us-up-the-bomb.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://redant.com.au/how-we-do/cache-busting-gmail-new-image-caching/"},"url":"https://redant.com.au/how-we-do/cache-busting-gmail-new-image-caching/"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="icon" href="/assets/images/favicon.ico" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" />
  <link rel="stylesheet" href="/assets/bundle/application.css" />
  <script src="/assets/bundle/application.js"></script>
  <script src="https://kit.fontawesome.com/c0cec62a8d.js" crossorigin="anonymous"></script>
  <script>
    if (!(window.fetch && window.Promise && [].includes && Object.assign && window.Map)) {
      document.write('<script src="https://cdn.polyfill.io/v3/polyfill.min.js?features=default,fetch"></scr'+'ipt>')
    }
  </script>
  
    <style>.async-hide { opacity: 0 !important} </style>

<script>
  var gtmId = window.location.host.includes("redant.com.au")
    ? "GTM-P7QNBDH"
    : "GTM-N3CM249";

  // Google Optimize page hiding snippet
  (function(a,s,y,n,c,h,i,d,e){s.className+=' '+y;
  h.end=i=function(){s.className=s.className.replace(RegExp(' ?'+y),'')};
  (a[n]=a[n]||[]).hide=h;setTimeout(function(){i();h.end=null},c);
  })(window,document.documentElement,'async-hide','dataLayer',500,{[gtmId]:true});

  // Google Tag Manager
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer',gtmId);
</script>

  
</head>

  <body class="">
    <div class="main-layout">
      <div
  data-controller="nav reveal normalise-height"
  data-reveal-hidden-class="open"
  data-action="normalise:height->nav#setHeight">
  <div class="nav-container" data-normalise-height-target="item">
    
      <div class="bg-dark text-white text-center p-2">
        <strong>A new way of working with us!</strong>
        Low monthly fixed cost. Access our team on demand to help you scale.
        <a href="/on-demand/" class="fw-bold ms-2">More info</a>
      </div>
    
    
    <nav class="navbar nav-overlay" data-reveal-target="item">
    
      <div class="container">
        <div class="d-flex flex-column">
          <div class="d-flex justify-content-between">
            <a href="/" class="navbar-brand">
              <img
                class="logo"
                src="/assets/images/logo.svg"
                alt="Red Ant logo"
              />
            </a>
            <div class="d-flex justify-content-end align-items-center w-100">
              <div class="d-none d-lg-block">
                <ul class="nav justify-content-end">
                  <li class="nav-item">
                    <a href="/get-started/" data-nav-target="item" class="nav-link">
                      Get started
                    </a>
                  </li>
                  
                  <li class="nav-item">
                    <a href="/on-demand/" data-nav-target="item" class="nav-link">
                      On Demand
                    </a>
                  </li>
                  
                  <li class="nav-item">
                    <a href="/about/" data-nav-target="item" class="nav-link">
                      About us
                    </a>
                  </li>
                  <li class="nav-item">
                    <a href="/portfolio/" data-nav-target="item" class="nav-link">
                      Portfolio
                    </a>
                  </li>
                  <li class="nav-item">
                    <a href="/technology/" data-nav-target="item" class="nav-link">
                      Technology
                    </a>
                  </li>
                  <li class="nav-item">
                    <a href="/blog/" data-nav-target="item" class="nav-link">Blog</a>
                  </li>
                  <li class="nav-item">
                    <a href="/contact-us/" data-nav-target="item" class="nav-link">
                      Contact
                    </a>
                  </li>
                </ul>
              </div>
              <button
                type="button"
                class="btn btn-link d-block d-lg-none nav-toggle-icon"
                data-action="click->reveal#toggle">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="container nav-links mx-4 mx-md-auto">
        <ul class="links">
          <li>
            <a href="/" data-nav-target="item">Home</a>
          </li>
          <li>
            <a href="/get-started/" data-nav-target="item">Get started</a>
          </li>
          
          <li>
            <a href="/on-demand/" data-nav-target="item">On Demand</a>
          </li>
          
          <li>
            <a href="/about/" data-nav-target="item">About us</a>
          </li>
          <li>
            <a href="/portfolio/" data-nav-target="item">Portfolio</a>
          </li>
          <li>
            <a href="/technology/" data-nav-target="item">Technology</a>
          </li>
          <li>
            <a href="/blog/" data-nav-target="item">Blog</a>
          </li>
          <li>
            <a href="/contact-us/" data-nav-target="item">Contact</a>
          </li>
        </ul>
      </div>
    </nav>
  </div>
</div>

      <section class="post-content pt-3 pb-5 text-md">
        <div class="container">
          <div class="row mb-sm-4">
            <div class="col-12">
              <div class="mb-3 pb-sm-5"><div id="breadcrumbs" class="text-capitalize mt-sm-5">
  
  <a href="/">Home</a>
    /
  <a
    href="/how-we-do/"
    >How we do</a
  >
     / Cache busting gmail new image caching  
</div>
</div>
              <h1 class="pb-2">Cache busting Gmail's new image caching</h1>
              <hr class="dash" />
            </div>
          </div>
          <div class="row">
            <div class="col-md-8 order-2 order-sm-1">
              <img
                class="img-fluid mb-4"
                src="/assets/uploads/2013/somebody-set-us-up-the-bomb.jpg"
                alt="Cache busting Gmail's new image caching"
              />
              <p>The basic story is that Google will now cache all images in HTML email on their own servers, instead of having your email load the images from the original source. This is great for speed and reliability, and also means as a marketer you can send images as part of your email communication. But it <strong>breaks</strong> tracking.</p>

<p>A common practice in email marketing is to place “tracking” images inside html emails in order to measure who opened which email when. A very important piece of information, which can be used both legitimately and nefariously. Google sunk this practice by turning images off by default. <a href="http://arstechnica.com/information-technology/2013/12/gmail-blows-up-e-mail-marketing-by-caching-all-images-on-google-servers/">Ars Technica has a good write up of the implications (Ars Technica: Gmail blows up e-mail marketing by caching all images on Google servers)</a> for email marketers (and illegitimate spammers). But it doesn’t try to answer any questions about how the image caching works, and how to get around it.</p>

<p>So that’s what I’ll try to do here.</p>

<h3 id="how-google-email-image-caching-actually-works-rather-than-how-email-vendors-would-prefer-to-believe-it-works">How Google email image caching actually works (rather than how email vendors would prefer to believe it works)</h3>

<p>To investigate how it actually works, we created some code to generate random images and send these in emails. We then measured when and how the image was retrieved from the host server. In other words, we didn’t just make stuff up. You can download the source file at the end of this post.</p>

<p>To start with we need to build out all the potential ways a tracking image could be served. This is a matrix of the construction of the URL:</p>

<ul>
  <li>Filename always the same - e.g. http://example.com/images/same.png</li>
  <li>Filename always the same, querystring unique between emails - e.g. http://example.com/images/same.png?12345</li>
  <li>Filename unique between emails- e.g. http://example.com/images/same-12345.png</li>
</ul>

<p>Also we need to consider the actual content of the image. Usually the images used for tracking are 1 pixel by 1 pixel transparent GIFs, but maybe the caching behaves differently depending on the actual content of the request, here are our variables:</p>

<ul>
  <li>File content always the same</li>
  <li>i.e. http://example.com/images/same.png always returns the same content</li>
  <li>File content different between emails</li>
  <li>i.e. http://example.com/images/different.png always returns the same content for that particular email</li>
  <li>File content always different</li>
  <li>i.e. http://example.com/images/different.png always returns different content for any email</li>
</ul>

<p>This gives us a matrix of 9 different scenarios (well 8 actually, because 2 of them are effectively the same). We can determine our file naming for the tests from the matrix. It looks like this:</p>

<table class="table table-bordered matrix">
<tbody>
<tr>
<td></td>
<td>File content always the same</td>
<td>File content different between emails</td>
<td>File content always different</td>
</tr>
<tr>
<td>Filename always the same</td>
<td class="active text-center" colspan="2">same.png</td>
<td class="active text-center">different-always.png</td>
</tr>
<tr>
<td>Filename always the same, querystring unique between emails</td>
<td class="active text-center">same.png?r=12345</td>
<td class="active text-center">different.png?r=12345</td>
<td class="active text-center">different.png?r=12345&amp;a=1</td>
</tr>
<tr>
<td>Filename always unique between emails</td>
<td class="active text-center">same-12345.png</td>
<td class="active text-center">different-12345.png</td>
<td class="active text-center">different-always-12345.png</td>
</tr>
</tbody>
</table>

<p>To generate the files which need to be generated is reasonably simple, I created a short script which created a 3 by 3 grid of random colour squares. Depending on the request, the colours would either always be the same, always be the same based on a token that is unique for each email, or always be different regardless of the unique token.</p>

<p>The result looks a bit like this:</p>

<table class="table table-bordered matrix">
<tbody>
<tr>
<td></td>
<td>File content always the same</td>
<td>File content different between emails</td>
<td>File content always different</td>
</tr>
<tr>
<td>Filename always the same</td>
<td class="active text-center" colspan="2"><img class="alignnone size-full wp-image-743" alt="same.png" src="/assets/uploads/2013/gmail-same.png" width="30" height="30" /></td>
<td class="active text-center"><img class="alignnone size-full wp-image-739" alt="different-always.png" src="/assets/uploads/2013/gmail-different-always-1.png" width="30" height="30" /></td>
</tr>
<tr>
<td>Filename always the same, querystring unique between emails</td>
<td class="active text-center"><img class="alignnone size-full wp-image-743" alt="same.png?12345" src="/assets/uploads/2013/gmail-same.png" width="30" height="30" /></td>
<td class="active text-center"><img class="alignnone size-full wp-image-742" alt="different.png?r=12345" src="/assets/uploads/2013/gmail-different.png" width="30" height="30" /></td>
<td class="active text-center"><img class="alignnone size-full wp-image-742" alt="different.png?r=12345&amp;a=1" src="/assets/uploads/2013/gmail-different-always-2.png" width="30" height="30" /></td>
</tr>
<tr>
<td>Filename always unique between emails</td>
<td class="active text-center"><img class="alignnone size-full wp-image-743" alt="same-12345.png" src="/assets/uploads/2013/gmail-same.png" width="30" height="30" /></td>
<td class="active text-center"><img class="alignnone size-full wp-image-742" alt="different-12345.png" src="/assets/uploads/2013/gmail-different.png" width="30" height="30" /></td>
<td class="active text-center"><img class="alignnone size-full wp-image-742" alt="different-always-12345.png" src="/assets/uploads/2013/gmail-different-always-3.png" width="30" height="30" /></td>
</tr>
</tbody>
</table>

<p>The left-hand column never changes its content between unique emails, the middle column should always be different for different emails, and without caching the column on the right should change on every “refresh” or open of the same email.</p>

<p>The test emails contained this matrix of images with the same random token for that email inserted for each image in the table. The emails were then sent to an existing email account hosted on Gmail. Server logs were watched for the image requests.</p>

<p>It was immediately apparent that the images were not cached on email receipt, that is Google does not fetch the images at the time it receives the email. Which makes sense emails opened would be less than emails received, and even Google would want to take steps to reduce the burden on their cache.</p>

<p>This was observed from 5 minutes up to 48 hours between send and open.</p>

<p>So the images load on open, that’s a huge relief for a start, but what images will be fetched uniquely for each recipient?</p>

<p>We tested separate and unique sends, with combinations of page reload with and without browser cache clearing. The result was that the most reliably re-fetched file versions were ones which included a querystring, regardless of their content.</p>

<p>Those were the files of the form:</p>

<ul>
  <li>same.png?r=12345</li>
  <li>different.png?r=12345</li>
  <li>different.png?r=12345&amp;a=1</li>
</ul>

<h2 id="results-in-a-nutshell">Results in a nutshell</h2>

<h4 id="1-images-are-retrieved-for-first-user-and-then-cached">1. Images are retrieved for first user and then cached</h4>

<p>When you send the email, nothing happens (which is unlike other systems like Facebook, where their bots behave proactively to retrieve images). When your email is opened the first time, the image is retrieved and then shown. From that point, every other request for the image is served off the Google image cache. Which is a good thing unless you’re a spammer or an email tracking company. Or unless you make the image unique (see #2)</p>

<h4 id="2-use-a-querystring">2. Use a querystring</h4>

<p>It seems that at this time simply including a querystring on the image request is enough to force the file to be refetched. Browser cache does get in the way of this though, so these images were re-fetched only if they were not in the browser cache.</p>

<h4 id="3-the-fetching-ip-will-be-google-rather-than-your-user">3. The fetching IP will be Google rather than your user</h4>

<p>So the first two points are not really much different from before as most tracking tags work this way. But all is not rosy. Because of Gmail’s caching, certain information we used to get for free from un-cached image tag requests will be lost. The IP address of the request will now always be one of Google’s caching servers, and the user agent will always be whatever Google decide they want it to be. Currently the user agent string for Gmail’s caching servers is:</p>

<p>Mozilla/5.0 (Windows; U; Windows NT 5.1; de; rv:1.9.0.7) Gecko/2009021910 Firefox/3.0.7 (via ggpht.com)</p>

<p>Losing the IP address means losing the closest thing we have to geographic data on email opens. There is no solution that I can think of which will allow you to obtain this information by other means directly. Javascript injection into the querystring certainly won’t work in Gmail, as their security process justifiably strips out Javascript. It may be possible to marry geographic data from clicks on the email to the open retrospectively if both the open and the click carry a common unique identifier.</p>

            </div>
            <div class="col-md-4 order-1 order-sm-2">
              
              <div class="post-detail-container section-border">
                <p>Google's new image caching mechanism in Gmail is an email marketer's nightmare come true. Here's how to keep tracking your email opens in Gmail.</p>
              </div>
              
              
<div data-controller="modal-carousel">
  

  <div
    id="gallery-modal"
    class="modal fade"
    role="dialog"
    tabindex="-1"
    aria-labelledby="gallery-modal"
    aria-hidden="true"
    data-modal-carousel-target="modal">
    <div class="modal-dialog modal-xl" role="document">
      <div class="modal-header">
        <button
          type="button"
          class="btn-close btn-close-white text-lg pe-auto"
          data-bs-dismiss="modal"
          aria-label="Close">
        </button>
      </div>
      <div class="modal-content">
        <div
          id="gallery-carousel"
          class="carousel slide"
          data-bs-ride="carousel"
          data-modal-carousel-target="carousel">
          <div class="carousel-inner">
            
          </div>
          <button
            type="button"
            class="carousel-control-prev"
            data-bs-target="#gallery-carousel"
            data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button
            type="button"
            class="carousel-control-next"
            data-bs-target="#gallery-carousel"
            data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

            </div>
          </div>
        </div>
      </section>
      <section class="pb-5 d-none d-sm-block">
        <div class="container" data-controller="fake-news"></div>
      </section>
      <footer class="footer py-5">
  <div class="container">
    <div class="row mb-4">
      <div class="col-6 col-lg-4 order-1">
        <p>
          <a href="mailto:info@redant.com.au">info@redant.com.au</a>
          <br>
          <a href="tel:+61292678300">+61 2 9267 8300</a>
          <br>
          <a href="/privacy-policy">Red Ant Privacy Policy</a>
        </p>
      </div>

      <div class="col-8 offset-2 col-md-12 offset-md-0 col-lg-4 order-3 order-lg-2">
        <p>
          <i class="fa fa-twitter"></i>
          <a href="https://twitter.com/r_e_d_a_n_t" target="_blank" class="ms-2">
            The most mundane Twitter, ever
          </a>
          <br>
          <i class="fa fa-linkedin-square"></i>
          <a href="https://www.linkedin.com/company/76862" target="_blank" class="ms-2">
            Stalk us on Linkedin
          </a>
        </p>
      </div>

      <div class="col-6 col-lg-4 order-2 order-lg-3">
        <p>
          PO Box 250, Vaucluse Sydney NSW 2030 Australia
          <br>
          ABN 87 081 223 252
        </p>
      </div>
    </div>

    <div class="row mb-4">
      <div class="col px-lg-5 text-center link-list">
        <a href="/jobs/" class="pri me-2">Careers</a>
        <span> | </span>
        <a href="/blog/" class="mx-2">Blog</a>
        <span> | </span>
        <a href="/automated-testing/" class="mx-2">Automated Testing</a>
        <span> | </span>
        <a href="/mobile/" class="mx-2">Mobile</a>
        <span> | </span>
        <a href="/software-development/" class="mx-2">Ruby Development</a>
        <span> | </span>
        <a href="/our-work/" class="mx-2">Our Work</a>
        <span> | </span>
        <a href="/red-ant-stuff/" class="mx-2">Red Ant</a>
        <span> | </span>
        <a href="/ruby-on-rails-devops/" class="mx-2">Devops</a>
        <span> | </span>
        <a href="/ruby-on-rails/" class="mx-2">Ruby on Rails developer</a>
        <span> | </span>
        <a href="/strategy/" class="mx-2">Strategy</a>
        <span> | </span>
        <a href="/our-work/" class="mx-2">Work updates</a>
        <span> | </span>
        <a href="/tool-reviews/" class="mx-2">Tool Reviews</a>
        <span> | </span>
        <a href="/portfolio/" class="mx-2">Our Portfolio</a>
        <span> | </span>
        <a href="/about/" class="mx-2">About Red Ant</a>
      </div>
    </div>

    <div class="row">
      <div class="col text-center">
        &copy; Red Ant 2022
      </div>
    </div>
  </div>
</footer>

<script>
  window.intercomSettings = {
    api_base: "https://api-iam.intercom.io",
    app_id: "fd4z6tu3",
    custom_launcher_selector:'.intercom-launcher'
  };
</script>

<script>
  // We pre-filled your app ID in the widget URL: 'https://widget.intercom.io/widget/fd4z6tu3'
  (function () {
    var w = window;
    var ic = w.Intercom;
    if (typeof ic === "function") {
      ic("reattach_activator");
      ic("update", w.intercomSettings);
    } else {
      var d = document;
      var i = function () {
        i.c(arguments);
      };
      i.q = [];
      i.c = function (args) {
        i.q.push(args);
      };
      w.Intercom = i;
      var l = function () {
        var s = d.createElement("script");
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://widget.intercom.io/widget/fd4z6tu3";
        var x = d.getElementsByTagName("script")[0];
        x.parentNode.insertBefore(s, x);
      };
      if (document.readyState === "complete") {
        l();
      } else if (w.attachEvent) {
        w.attachEvent("onload", l);
      } else {
        w.addEventListener("load", l, false);
      }
    }
  })();
</script>

    </div>
  </body>
</html>
